<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<title>Deuce is (not yet) Emacs under Clojure</title>
	<meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<meta name="viewport" content="width=1274, user-scalable=no">
	<link rel="stylesheet" href="themes/ribbon/styles/style.css">
	<link rel="stylesheet" media="print" href="themes/ribbon/styles/print.css">
        <link type="text/css" rel="stylesheet" href="scripts/highlight.js/styles/idea.css"/>
        <!-- <link type="text/css" rel="stylesheet" href="scripts/google-code-prettify/prettify.css"/> -->
	<style>
.slide header {
    bottom: 0;
    left: 0;
    margin: 0;
    text-align: right;
    position: absolute;
    padding-right: 20px;
    width: 1004px;
    border-top: 1px solid #ddd;
    background: rgba(255, 255, 255, 0.75);
}

.slide header h2 {
    letter-spacing: 0.1em;
    color: #111;
}

.slide section:before {
    background:none;
}

.slide section {
    letter-spacing: 0.05em;
    padding:60px 60px 0;
    width:904px;
    height:580px;
    color: #222;
}

.slide section > h1 {
    text-align: center;
    font-weight: bold;
    font-size: 120%;
}

.slide pre {
    font-size: 80%;
    margin-top: -40px;
    margin-bottom: -40px;
}

.slide section {
    background: white;
    font-size: 135%;
}

.slide ul > li:before {
    content: '';
}

.slide li > ul {
    font-size: 75%;
    color: #888;
}

.slide a {
    text-decoration: none;
    border-bottom: none;
}

.slide:after {
    content:'';
}

.pull-right {
    font-family: sans-serif;
    font-weight: bold;
    font-size: 22px;
    color: #aaa;
    right: 40px;
    position: absolute;
}

sup {
    font-size: 50%;
    vertical-align: super;
}

.twocol {
  -webkit-column-count: 2;
  -webkit-column-gap: 20px;
  -moz-column-count: 2;
  -moz-column-gap: 20px;
}
	</style>
</head>
<body class="list">
	<header class="caption">
		<h1>Deuce is (not yet) Emacs under Clojure</h1>
                <p>Copyright © 2012-2013 <a href="https://github.com/hraberg/">Håkan Råberg</a> | <a href="http://github.com/pepelsbey/shower/">shower</a></p>
	</header>

	<div class="slide" id="Deuce"><div>
	    <section>
	      <header>
		<h2>DEUCE is (not yet) Emacs under Clojure</h2>
	      </header>
	    </section>
	</div></div>
	<div class="slide" id="What"><div>
	    <section>
	      <header>
		<h2>What</h2>
	      </header>
              <ul>
                <li>
                  <strong>Emacs on the JVM</strong>
                  <ul>
                    <li>
                      <pre class="lisp"><code>
GNU Emacs 24.2 (jvm-1.8.0-ea_clojure-1.5.1)
 of 2013-05-04 on X202E
                      </code></pre>
                    </li>
                  </ul>
                </li>
                <li>C parts of Emacs rewritten in Clojure</li>
                <li>Emacs Lisp transpiled to Clojure</li>
              </ul>
	    </section>
	</div></div>
	<div class="slide" id="Why"><div>
	    <section>
	      <header>
		<h2>Why</h2>
	      </header>
              <ul>
                <li>
                  <strong>Maintain the spirit of Emacs</strong>
                  <ul>
                    <li><em>Emacs is the 100-year editor</em><sup><a href="https://sites.google.com/site/steveyegge2/tour-de-babel">1</a></sup> &mdash; Steve Yegge <span class="pull-right">2004</span></li>
                  </ul>
                </li>
                <li>
                  Changing core Emacs is hard
                  <ul>
                    <li>Merging changes back upstream even harder</li>
                    <li>30 year old rock solid C codebase with millions of users</li>
                  </ul>
                </li>
                <li>
                  Deprecate Emacs Lisp in favour of Clojure
                  <ul>
                    <li>Industry momentum</li>
                    <li>JVM and Clojure replaces the Emacs Lisp runtime</li>
                  </ul>
                </li>
                <li>Learn Emacs</li>
              </ul>
	    </section>
	</div></div>
	<div class="slide" id="How"><div>
	    <section>
	      <header>
		<h2>How</h2>
	      </header>
              <ul>
                <li>
                  20k LOC Clojure for the Emacs API
                  <ul>
                    <li>Emacs contains about 1000 C subrs over 100k LOC</li>
                    <li>1/5 actually implemented</li>
                  </ul>
                </li>
                <li>
                  1000 LOC Emacs Lisp compiler
                  <ul>
                    <li>The Emacs Lisp special forms as Clojure macros</li>
                    <li>Additional tree transformation</li>
                  </ul>
                </li>
                <li>
                  500 LOC Emacs Lisp Reader
                  <ul>
                    <li>2/3 to parse Emacs Lisp characters</li>
                  </ul>
                </li>
                <li>Mutable PersistentList</li>
              </ul>
	    </section>
	</div></div>
	<div class="slide" id="Development"><div>
	    <section>
	      <header>
		<h2>Development</h2>
	      </header>
              <ul>
                <li>Lanterna<sup><a href="http://code.google.com/p/lanterna/">1</a></sup>
                  <ul>
                    <li>
                      Pure Java TUI via clojure-lanterna
                    </li>
                  </ul>
                </li>
                <li>
                  Emacs as git submodule
                  <ul>
                    <li>Deuce depends on the Emacs Lisp</li>
                  </ul>
                </li>
                <li>
                  loadup.el
                  <ul>
                    <li>The actual Emacs boot</li>
                  </ul>
                </li>
                <li>
                  A/B testing Emacs *scratch* vs Clojure REPL
                  <ul>
                    <li>Swank or nREPL running inside Deuce</li>
                  </ul>
                </li>
              </ul>
	    </section>
	</div></div>
	<div class="slide" id="Emacs History"><div>
	    <section>
	      <header>
		<h2>Emacs History<sup><a href="http://www.jwz.org/doc/emacs-timeline.html">1</a></sup></h2>
	      </header>
              <ul>
                <li>
                  TECO <span class="pull-right">1972</span>
                  <ul>
                    <li>Stallman's Editor MACroS <span class="pull-right">1976</span></li>
                  </ul>
                </li>
                <li>MulticsEmacs <span class="pull-right">1978</span></li>
                <li>GNU Emacs <span class="pull-right">1985</span></li>
                <li>XEmacs <span class="pull-right">1991</span></li>
                <li>
                  Emacs in Lisp
                  <ul>
                    <li>Zmacs, Portable Hemlock, Climacs, LiCE</li>
                  </ul>
                </li>
                <li>
                  Ersatz Emacsen
                  <ul>
                    <li>uEmacs, Zile, mg</li>
                  </ul>
                </li>
              </ul>
	    </section>
	</div></div>
	<div class="slide w cover" id="THE Emacs Paper"><div>
	    <section>
	      <header>
		<h2>1981<sup><a href="http://dspace.mit.edu/bitstream/handle/1721.1/5736/AIM-519A.pdf">1</a></sup></h2>
	      </header>
              <img src="images/emacs-paper.png"/>
	    </section>
	</div></div>
	<div class="slide cover" id="Lucid Emacs / XEmacs"><div>
	    <section>
	      <header>
		<h2>1990s Lucid Emacs / XEmacs<sup><a href="http://www.jwz.org/doc/lemacs.html">1</a></sup></h2>
	      </header>
              <img src="images/energize.jpg"/>
	    </section>
	</div></div>
	<div class="slide cover" id="Patterns of Software"><div>
	    <section>
	      <header>
		<h2>1996<sup><a href="http://www.dreamsongs.com/Files/PatternsOfSoftware.pdf">1</a></sup></h2>
	      </header>
              <img src="images/patterns-of-software.jpg"/>
	    </section>
	</div></div>
	<div class="slide cover" id="Craft of Text Editing"><div>
	    <section>
	      <header>
		<h2>The Craft of Text Editing<sup><a href="http://www.finseth.com/emacs.html">1</a></sup></h2>
	      </header>
              <img src="images/craft-cover.png"/>
	    </section>
	</div></div>
	<div class="slide" id="Emacs Like Editors"><div>
	    <section>
	      <header>
		<h2>Emacs Like Editors</h2>
	      </header>
              <ul>
                <li>
                  JEmacs<sup><a href="http://jemacs.sourceforge.net/">1</a></sup> <span class="pull-right">1999</span>
                  <ul>
                    <li>Java / Kawa</li>
                  </ul>
                </li>
                <li>
                  Eclipse<sup><a href="http://eclipse.org/">2</a></sup> <span class="pull-right">2001</span>
                  <ul>
                    <li>Java</li>
                  </ul>
                </li>
                <li>
                  Yi<sup><a href="http://www.haskell.org/haskellwiki/Yi/">3</a></sup> <span class="pull-right">2005</span>
                  <ul>
                    <li>Haskell</li>
                  </ul>
                </li>
                <li>
                  Ymacs<sup><a href="http://www.ymacs.org/">4</a></sup> <span class="pull-right">2009</span>
                  <ul>
                    <li>Javascript</li>
                  </ul>
                </li>
                <li>
                  Light Table<sup><a href="http://www.lighttable.com/">5</a></sup> <span class="pull-right">2012</span>
                  <ul>
                    <li>ClojureScript</li>
                  </ul>
                </li>
              </ul>
	    </section>
	</div></div>
	<div class="slide" id="Emacs Source"><div>
	    <section>
	      <header>
		<h2>Emacs Source</h2>
	      </header>
<br/>
<pre><code class="twocol">buffer.c
coding.c
data.c
editfns.c
eval.c
fileio.c
fns.c
frame.c
keyboard.c
keymap.c
lread.c
minibuf.c
process.c
search.c
window.c
xdisp.c
...
</code></pre>
<br/>
203692 lines of C in 65 files / 1064 DEFUNs
	    </section>
	</div></div>
	<div class="slide" id="Primitives - C"><div>
	    <section>
	      <header>
		<h2>Primitives - C</h2>
	      </header>
              <pre class="prettyprint"><code>
DEFUN ("sqrt", Fsqrt, Ssqrt, 1, 1, 0,
       doc: /* Return the square root of ARG.  */)
  (register Lisp_Object arg) {
  double d = extract_float (arg);
#ifdef FLOAT_CHECK_DOMAIN
  if (d < 0.0)
    domain_error ("sqrt", arg);
#endif
  IN_FLOAT (d = sqrt (d), "sqrt", arg);
  return make_float (d);
}
              </code></pre>
	    </section>
	</div></div>
	<div class="slide" id="Primitives - Clojure"><div>
	    <section>
	      <header>
		<h2>Primitives - Clojure</h2>
	      </header>
              <pre class="lisp"><code>
(defun sqrt (arg)
  "Return the square root of ARG."
  (Math/sqrt arg))
<hr/>
<span class="pull-right">Emacs Lisp defun</span>(defun make-vector (length init)
  "Return a newly created vector of length LENGTH,
   with each element being INIT.
  See also the function `vector'."
<span class="pull-right">Clojure body</span>  (doto (object-array length)
<span class="pull-right">Java interop</span>    (Arrays/fill init))
</code></pre>
	    </section>
	</div></div>
	<div class="slide" id="Variables"><div>
	    <section>
	      <header>
		<h2>Variables</h2>
	      </header>
              <strong>Emacs Lisp is a Lisp-2</strong>
              <pre class="lisp"><code>
<span class="pull-right">Clojure</span>(defn el-var [name]
  ((some-fn
    *dynamic-vars*
    (partial el-var-buffer-local true)
    global)
   name))
...
(create-ns 'deuce.emacs-lisp.globals)
              </code></pre>
	    </section>
	</div></div>
	<div class="slide" id="Dynamic Scope"><div>
	    <section>
	      <header>
		<h2>Dynamic Scope</h2>
	      </header>
              <pre class="lisp"><code>
<span class="pull-right">Emacs Lisp</span>(defvar x -99) ⇒ x

(defun getx ()
  x)           ⇒ getx

(let ((x 1))
  (getx))      ⇒ 1

(getx)         ⇒ -99
              </code></pre>
	    </section>
	</div></div>
        <div class="slide" id="Emacs Lisp Transpiler"><div>
	    <section>
	      <header>
		<h2>Emacs Lisp Transpiler</h2>
	      </header>
              Transliper in ~30 macros
               <pre class="lisp"><code>
<span class="pull-right">Clojure</span>(c/defmacro ^:clojure-special-form if
  [cond then & else]
  `(c/cond (not-null? ~(el->clj cond)) ~(el->clj then)
           :else (progn ~@else)))

(c/defmacro progn [& body]
  `(do ~@(map el->clj body)))
               </code></pre>
	    </section>
	</div></div>
        <div class="slide" id="Emacs Lisp -> Clojure"><div>
	    <section>
	      <header>
		<h2>Emacs Lisp -> Clojure</h2>
	      </header>
               <pre class="lisp" style="font-size: 25%;"><code>
<span class="pull-right">Clojure</span>
;; Break this up and explain what the different branches are doing and why.
(defn el->clj [x]
  (condp some [x]
    #{()} nil
    seq? (c/let [[fst & rst] x]
                (if (c/and (symbol? fst)
                           (not= 'progn fst)
                           (-> (fun fst) meta :macro))
                  (if (c/or (clojure-special-forms fst) ('#{let lambda} fst)) ;; defun defvar ?
                    (if (= 'quote fst)
                      (if-let [s (c/and (symbol? (first rst)) (not (next rst)) (first rst))]
                        (list 'quote (if (= "deuce.emacs" (namespace s)) (sym s) s))
                        (if (= '(()) rst) () x))
                      (apply cons/list (c/cons (symbol "deuce.emacs-lisp" (name fst)) rst)))
                    (apply cons/list x))
                  (if (#{`el-var-get `el-var-set `el-var-set-default `delayed-eval
                         '#el/sym "\\," '#el/sym "\\,@"} fst)
                    x
                    (if (=  '#el/sym "\\`" fst)
                      (emacs-lisp-backquote x) ;; See below, we dont want to duplicate this if not necessary.
                      (if (c/and (symbol? fst)
                                 (not (namespace fst))
                                 (not (fun fst)))
                        (if (*disallow-undefined* fst)
                          `(throw* '~'void-function '~fst)
                          (do (debug fst "NOT DEFINED")
                              (list `delayed-eval x)))

                        (expand-dotted-lists (c/cons
                                              (if (seq? fst) (el->clj fst) fst)
                                              (map el->clj rst))))))))
    symbol? (if (namespace x)
              (if (-> (resolve x) meta :macro) (resolve x) x)
              (if (#{'#el/sym "\\," '#el/sym "\\,@" '.} x)
                x
                (list `el-var-get x)))
    x))
              </code></pre>
	    </section>
	</div></div>
        <div class="slide" id="Macroexpansion"><div>
	    <section>
	      <header>
		<h2>Macroexpansion</h2>
	      </header>
               <pre class="lisp"><code>
<span class="pull-right">Emacs Lisp</span>(let ((x 1))
  (getx))

  ⇒

<span class="pull-right">Clojure</span>(let* [local__2368 1
       x local__2368]
  (deuce.emacs-lisp/with-local-el-vars (x x)
    (deuce.emacs-lisp/progn
      (getx))))
              </code></pre>
	    </section>
	</div></div>
	<div class="slide" id="Editor Domain"><div>
	    <section>
	      <header>
		<h2>Editor Domain</h2>
	      </header>
<br/>
<pre><code class="twocol">CharTable
BufferText
Buffer
Marker
Frame
Window
...
</code></pre>
<br/>
	    </section>
	</div></div>

	<div class="slide cover w" id="Demo"><div>
	    <section>
	      <header>
		<h2>M-x demo</h2>
	      </header>
              <img src="images/deuce-lanterna.png"/>
	    </section>
	</div></div>
	<div class="slide" id="0.1.0"><div>
	    <section>
	      <header>
		<h2>0.1.0 Developer Preview</h2>
	      </header>
              <ul>
                <li><strong>Q2</strong> <span class="pull-right">2013</span></li>
                <li>Main moving parts connected</li>
                <li>
                  Basic editor functionality
                  <ul>
                    <li>Possible to complete the Emacs Tutorial</li>
                    <li>Not yet intended for actual use</li>
                  </ul>
                </li>
                <li>
                  Conversation starter
                  <ul>
                    <li>Is there any interest for this?</li>
                    <li>Share the workload</li>
                  </ul>
                </li>
              </ul>
	    </section>
	</div></div>
	<div class="slide" id="Future"><div>
	    <section>
	      <header>
		<h2>Future</h2>
	      </header>
              <ul>
                <li>
                  Further Emacs compatibility <span class="pull-right">2013</span>
                  <ul>
                    <li>Legacy support is key</li>
                    <li>org-mode has large test suite</li>
                  </ul>
                </li>
                <li>
                  Clojure as first class citizen
                  <ul>
                    <li>Ability to write idiomatic Clojure extensions</li>
                    <li>Reshape the core API and redraw the legacy boundary</li>
                  </ul>
                </li>
                <li>Extensible Web UI <span class="pull-right">2014</span></li>
                <li>Emacs as library</li>
              </ul>
	    </section>
	</div></div>
	<div class="slide" id="End"><div>
	    <section>
	      <header>
		<h2><a href="https://github.com/hraberg/deuce">github.com/hraberg/deuce</a></h2>
	      </header>
              <em>Wings, the band Beatles could have been<sup><a href="http://www.youtube.com/watch?v=tyZspqjtG2k">1</a></sup></em>
	    </section>
	</div></div>

	<script src="scripts/script.js"></script>
	<!-- <script src="scripts/google-code-prettify/run_prettify.js"></script> -->
	<!-- <script src="scripts/google-code-prettify/lang-clj.js"></script> -->
        <script type="text/javascript" src="scripts/highlight/highlight.pack.js"></script>

        <script>
          hljs.tabReplace = '    ';
          hljs.initHighlightingOnLoad();
        </script>

	<!-- Shower Copyright © 2010–2012 Vadim Makeev — pepelsbey.net -->
</body>
</html>
